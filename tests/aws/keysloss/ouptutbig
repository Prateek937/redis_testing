cluster Size: 1
------------------------------------------------------------------

[34m******* init  *******[0m

[33m### CREATING CLUSTER OF 3 NODES  172.31.5.199:6379 172.31.5.141:6379 172.31.5.16:6379 ###
[0m
> redis-cli --cluster create  172.31.5.199:6379 172.31.5.141:6379 172.31.5.16:6379 --cluster-replicas 0 --cluster-yes | grep OK | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 0,
  keys2: 0,
  keys: 0,
  slots1: 0,
  slots2: 16384,
  nodes1: 1,
  nodes2: 3,
  nodes: 2
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 0 slots | 0 slaves.
[OK] 0 keys in 1 masters.
0.00 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 0 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 0 keys | 5461 slots | 0 slaves.
[OK] 0 keys in 3 masters.
0.00 keys per slot on average.
 
total slots: 16384
cluster created successfully

[34m******* init  completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
[OK] 500000 keys in 3 masters.
30.52 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 500000 keys in 4 masters.
30.52 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 500000 keys in 5 masters.
30.52 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 500000 keys in 6 masters.
30.52 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 500000 keys in 7 masters.
30.52 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166558 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166566 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166876 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 500000 keys in 8 masters.
30.52 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 62494 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 62503 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 62482 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 62469 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 62347 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 62487 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 62511 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 62707 keys | 2048 slots | 0 slaves.
[OK] 500000 keys in 8 masters.
30.52 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 124995 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 125021 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 124987 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124978 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 8 masters.
61.04 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 124995 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 125021 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 124987 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124978 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 8 masters.
61.04 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.199', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 125021 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 83275 keys | 1365 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124978 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 8 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 125021 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 41615 keys | 682 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166638 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 8 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.16', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166636 keys | 2730 slots | 1 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166638 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 7 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.157:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.157:6379 fbf4971607b901aa52448c77e36f0a8272a6ce48
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166636 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124977 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166638 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 7 masters.
61.04 keys per slot on average.
 
total slots: 16384
Removing node fbf4971607b901aa52448c77e36f0a8272a6ce48 from cluster 172.31.5.157:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 166636 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 83303 keys | 1365 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 7 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 166707 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 208324 keys | 3413 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 41615 keys | 682 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 7 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 208322 keys | 3413 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 208324 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 6 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 208322 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 208324 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 125042 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 6 masters.
61.04 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 208322 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 83360 keys | 1365 slots | 0 slaves.
[OK] 1000000 keys in 6 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 250037 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 208312 keys | 3414 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 41645 keys | 682 slots | 0 slaves.
[OK] 1000000 keys in 6 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 250037 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249957 keys | 4096 slots | 1 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 5 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 250037 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124961 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249957 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 5 masters.
61.04 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 83299 keys | 1365 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249957 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 5 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250006 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 41596 keys | 682 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 291660 keys | 4779 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 5 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 291602 keys | 4778 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 291660 keys | 4779 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 4 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 291602 keys | 4778 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 291660 keys | 4779 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 125039 keys | 2048 slots | 0 slaves.
[OK] 1000000 keys in 4 masters.
61.04 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 291602 keys | 4778 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 333362 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 83337 keys | 1365 slots | 0 slaves.
[OK] 1000000 keys in 4 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.16', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 291699 keys | 4779 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 333310 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 333362 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 41629 keys | 682 slots | 0 slaves.
[OK] 1000000 keys in 4 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.199', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 333328 keys | 5461 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 333310 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 333362 keys | 5462 slots | 0 slaves.
[OK] 1000000 keys in 3 masters.
61.04 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.113:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.113:6379 18ce0ded73b106a39ba787811bc8776ededa500f
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 333328 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 333310 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 333362 keys | 5462 slots | 0 slaves.
[OK] 1000000 keys in 3 masters.
61.04 keys per slot on average.
 
total slots: 16384
Removing node 18ce0ded73b106a39ba787811bc8776ededa500f from cluster 172.31.5.113:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 333328 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 333310 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 333362 keys | 5462 slots | 0 slaves.
[OK] 1000000 keys in 3 masters.
61.04 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
[OK] 1500000 keys in 3 masters.
91.55 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 1500000 keys in 4 masters.
91.55 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 1500000 keys in 5 masters.
91.55 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 1500000 keys in 6 masters.
91.55 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 1500000 keys in 7 masters.
91.55 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500025 keys | 5461 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500003 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499972 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 1500000 keys in 8 masters.
91.55 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 187492 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 187494 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 187615 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 187462 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 187493 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 187502 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 187424 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 187518 keys | 2048 slots | 0 slaves.
[OK] 1500000 keys in 8 masters.
91.55 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 249978 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 250181 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 250081 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 8 masters.
122.07 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 249978 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 250181 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 250081 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 8 masters.
122.07 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.199', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 187406 keys | 1536 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 250181 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 250081 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 8 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.141', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 250022 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 124977 keys | 1024 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 312610 keys | 2560 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 250081 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 8 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.16', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 312597 keys | 2560 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 62402 keys | 512 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 312610 keys | 2560 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 250081 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 8 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.113', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 312597 keys | 2560 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 312610 keys | 2560 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 312483 keys | 2560 slots | 1 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 7 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.157:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.157:6379 fbf4971607b901aa52448c77e36f0a8272a6ce48
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 312597 keys | 2560 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249919 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 312610 keys | 2560 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 312483 keys | 2560 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 7 masters.
122.07 keys per slot on average.
 
total slots: 16384
Removing node fbf4971607b901aa52448c77e36f0a8272a6ce48 from cluster 172.31.5.157:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 312597 keys | 2560 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 187514 keys | 1536 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 312483 keys | 2560 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 7 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375260 keys | 3072 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 124851 keys | 1024 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 312483 keys | 2560 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 7 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312594 keys | 2560 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375260 keys | 3072 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 62409 keys | 512 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374925 keys | 3072 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 7 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375003 keys | 3072 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375260 keys | 3072 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374925 keys | 3072 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 6 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375003 keys | 3072 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375260 keys | 3072 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374925 keys | 3072 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 249817 keys | 2048 slots | 0 slaves.
[OK] 2000000 keys in 6 masters.
122.07 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375003 keys | 3072 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374925 keys | 3072 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 187403 keys | 1536 slots | 0 slaves.
[OK] 2000000 keys in 6 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375003 keys | 3072 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 437378 keys | 3584 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 124950 keys | 1024 slots | 0 slaves.
[OK] 2000000 keys in 6 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 437558 keys | 3584 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 375015 keys | 3072 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 437378 keys | 3584 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 62395 keys | 512 slots | 0 slaves.
[OK] 2000000 keys in 6 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 437558 keys | 3584 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437410 keys | 3584 slots | 1 slaves.
172.31.5.113:6379 (18ce0ded...) -> 437378 keys | 3584 slots | 0 slaves.
[OK] 2000000 keys in 5 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 437558 keys | 3584 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 249980 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437410 keys | 3584 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 437378 keys | 3584 slots | 0 slaves.
[OK] 2000000 keys in 5 masters.
122.07 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.113', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 437558 keys | 3584 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 187585 keys | 1536 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437410 keys | 3584 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 5 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500146 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 124997 keys | 1024 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437410 keys | 3584 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 5 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500146 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437674 keys | 3584 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 62522 keys | 512 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499885 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 5 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 512 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500146 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500196 keys | 4096 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499885 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 4 masters.
122.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500146 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500196 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499885 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 4 masters.
122.07 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500146 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500196 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499885 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 499773 keys | 4096 slots | 0 slaves.
[OK] 2000000 keys in 4 masters.
122.07 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625212 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 625114 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624925 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 624749 keys | 4096 slots | 0 slaves.
[OK] 2500000 keys in 4 masters.
152.59 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625212 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 625114 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624925 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 624749 keys | 4096 slots | 0 slaves.
[OK] 2500000 keys in 5 masters.
152.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625212 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 625114 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624925 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 624749 keys | 4096 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 2500000 keys in 6 masters.
152.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625212 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 625114 keys | 4096 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624925 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 624749 keys | 4096 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 2500000 keys in 7 masters.
152.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625212 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 625114 keys | 4096 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624925 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 624749 keys | 4096 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 2500000 keys in 8 masters.
152.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 312497 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 312519 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 312368 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 312389 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 312715 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 312557 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 312360 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 312595 keys | 2048 slots | 0 slaves.
[OK] 2500000 keys in 8 masters.
152.59 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375118 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375026 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 375053 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 374989 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374997 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 375118 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375026 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 375053 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 374989 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374997 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.199', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375026 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 299938 keys | 1638 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 374989 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374997 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.141', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 375026 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 224824 keys | 1228 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 450103 keys | 2458 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374997 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.16', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 450014 keys | 2458 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 149836 keys | 818 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 450103 keys | 2458 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 374997 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.113', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 450014 keys | 2458 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 374824 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 74821 keys | 409 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 450103 keys | 2458 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 450012 keys | 2457 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 8 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.154', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 450014 keys | 2458 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 449645 keys | 2457 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 450103 keys | 2458 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 450012 keys | 2457 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.157:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.157:6379 fbf4971607b901aa52448c77e36f0a8272a6ce48
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 450014 keys | 2458 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 374999 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 449645 keys | 2457 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 450103 keys | 2458 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 450012 keys | 2457 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
Removing node fbf4971607b901aa52448c77e36f0a8272a6ce48 from cluster 172.31.5.157:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 450014 keys | 2458 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 299793 keys | 1638 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 449645 keys | 2457 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 450012 keys | 2457 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 525028 keys | 2868 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 224779 keys | 1228 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 449645 keys | 2457 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 450012 keys | 2457 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 525028 keys | 2868 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 149728 keys | 818 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 449645 keys | 2457 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 525063 keys | 2867 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.154', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 450233 keys | 2458 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 525028 keys | 2868 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 74893 keys | 409 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 524480 keys | 2866 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 525063 keys | 2867 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 7 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 525126 keys | 2867 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 525028 keys | 2868 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 524480 keys | 2866 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 525063 keys | 2867 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 525126 keys | 2867 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 525028 keys | 2868 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 524480 keys | 2866 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 525063 keys | 2867 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 374994 keys | 2048 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 525126 keys | 2867 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 524480 keys | 2866 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 525063 keys | 2867 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 299867 keys | 1638 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 525126 keys | 2867 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 524480 keys | 2866 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 224757 keys | 1228 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.154', slots: 410 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 525126 keys | 2867 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 599513 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 149724 keys | 818 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 599997 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 599513 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 525309 keys | 2868 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 74853 keys | 409 slots | 0 slaves.
[OK] 3000000 keys in 6 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 409 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 599997 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 599513 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 600162 keys | 3277 slots | 1 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
[OK] 3000000 keys in 5 masters.
183.11 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 599997 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 599513 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 600162 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
[OK] 3000000 keys in 5 masters.
183.11 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 599997 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 600155 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 599513 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 600162 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 600173 keys | 3277 slots | 0 slaves.
[OK] 3000000 keys in 5 masters.
183.11 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 699986 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 700165 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 699424 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 700082 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 700343 keys | 3277 slots | 0 slaves.
[OK] 3500000 keys in 5 masters.
213.62 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 699986 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 700165 keys | 3278 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 699424 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 700082 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 700343 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3500000 keys in 6 masters.
213.62 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 699986 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 700165 keys | 3278 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 699424 keys | 3276 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 700082 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 700343 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3500000 keys in 7 masters.
213.62 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 699986 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 700165 keys | 3278 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 699424 keys | 3276 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 700082 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 700343 keys | 3277 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3500000 keys in 8 masters.
213.62 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 437603 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437523 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 437464 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 437147 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 437700 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437464 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 437571 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 437528 keys | 2048 slots | 0 slaves.
[OK] 3500000 keys in 8 masters.
213.62 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500021 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500040 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 500249 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499948 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 500056 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 500021 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500040 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 500249 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499948 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 500056 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 342, 342, 341, 341, 341, 341 ] }
[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.199', slots: 342 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500040 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 416680 keys | 1706 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499948 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 500056 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.141', slots: 342 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 500040 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 333038 keys | 1364 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 500056 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.16', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 249865 keys | 1023 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 500056 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.113', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 499683 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 166525 keys | 682 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.154', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 83257 keys | 341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 499986 keys | 2048 slots | 0 slaves.
[OK] 4000000 keys in 8 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.89 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.89', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 1 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.157:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.157:6379 fbf4971607b901aa52448c77e36f0a8272a6ce48
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 500017 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
Removing node fbf4971607b901aa52448c77e36f0a8272a6ce48 from cluster 172.31.5.157:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 342, 342, 341, 341, 341, 341 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 342 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 583213 keys | 2389 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 416637 keys | 1706 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 342 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 333042 keys | 1364 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 583396 keys | 2389 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 249777 keys | 1023 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 582951 keys | 2389 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.154', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 166519 keys | 682 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 666209 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583243 keys | 2389 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.89 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.89', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583590 keys | 2390 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 83349 keys | 341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 666209 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 666413 keys | 2730 slots | 0 slaves.
[OK] 4000000 keys in 7 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 341 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 666939 keys | 2731 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 666209 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 666413 keys | 2730 slots | 0 slaves.
[OK] 4000000 keys in 6 masters.
244.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 666939 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 666209 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 666413 keys | 2730 slots | 0 slaves.
[OK] 4000000 keys in 6 masters.
244.14 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 666939 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 666808 keys | 2731 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 666209 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 666970 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 666661 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 666413 keys | 2730 slots | 0 slaves.
[OK] 4000000 keys in 6 masters.
244.14 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 750187 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 750140 keys | 2731 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 749644 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 750411 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 749867 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 749751 keys | 2730 slots | 0 slaves.
[OK] 4500000 keys in 6 masters.
274.66 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 6 }
[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 750187 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 750140 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 749644 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 750411 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 749867 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 749751 keys | 2730 slots | 0 slaves.
[OK] 4500000 keys in 7 masters.
274.66 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 750187 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 750140 keys | 2731 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 749644 keys | 2730 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 750411 keys | 2732 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 749867 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 749751 keys | 2730 slots | 0 slaves.
[OK] 4500000 keys in 8 masters.
274.66 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 562415 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 562522 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 562768 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 562472 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 562387 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 562511 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 562505 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 562420 keys | 2048 slots | 0 slaves.
[OK] 4500000 keys in 8 masters.
274.66 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625101 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 624998 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 624820 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624901 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 625080 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 625101 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 624998 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 624820 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624901 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 625080 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [
    293, 293, 293,
    293, 292, 292,
    292
  ] }
[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.199', slots: 293 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 624998 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 535516 keys | 1755 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 624901 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 625080 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.141', slots: 293 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 624998 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 446100 keys | 1462 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 625080 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.16', slots: 293 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 356739 keys | 1169 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 625080 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.113', slots: 293 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 624907 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 267318 keys | 876 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.154', slots: 292 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 714055 keys | 2340 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 178170 keys | 584 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 624844 keys | 2048 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.89 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.89', slots: 292 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 625349 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 714055 keys | 2340 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 89133 keys | 292 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 713881 keys | 2340 slots | 0 slaves.
[OK] 5000000 keys in 8 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.157 TO 172.31.5.87 ###
[0m
{ reshardFrom: '172.31.5.157', reshardTo: '172.31.5.87', slots: 292 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 714482 keys | 2340 slots | 1 slaves.
172.31.5.154:6379 (20733dcc...) -> 714055 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 713881 keys | 2340 slots | 0 slaves.
[OK] 5000000 keys in 7 masters.
305.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.157:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.157:6379 fbf4971607b901aa52448c77e36f0a8272a6ce48
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 714482 keys | 2340 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 714055 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 713881 keys | 2340 slots | 0 slaves.
[OK] 5000000 keys in 7 masters.
305.18 keys per slot on average.
 
total slots: 16384
Removing node fbf4971607b901aa52448c77e36f0a8272a6ce48 from cluster 172.31.5.157:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 714405 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 714359 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 714482 keys | 2340 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 714055 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 714317 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 714501 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 713881 keys | 2340 slots | 0 slaves.
[OK] 5000000 keys in 7 masters.
305.18 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 785805 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 785853 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 785843 keys | 2340 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 785766 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 7 masters.
335.69 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 785805 keys | 2341 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 785853 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 785843 keys | 2340 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 785766 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 7 masters.
335.69 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 785853 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 523910 keys | 1560 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 785766 keys | 2341 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 7 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 785853 keys | 2341 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 262017 keys | 780 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1047659 keys | 3121 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 7 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1047870 keys | 3121 slots | 1 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1047659 keys | 3121 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 6 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1047870 keys | 3121 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1047659 keys | 3121 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 785307 keys | 2340 slots | 0 slaves.
[OK] 5500000 keys in 6 masters.
335.69 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1047870 keys | 3121 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 523577 keys | 1560 slots | 0 slaves.
[OK] 5500000 keys in 6 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1047738 keys | 3121 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1309646 keys | 3901 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 261801 keys | 780 slots | 0 slaves.
[OK] 5500000 keys in 6 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1309539 keys | 3901 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1309646 keys | 3901 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 5 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1309539 keys | 3901 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1309646 keys | 3901 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 785571 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 5 masters.
335.69 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1309539 keys | 3901 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 523474 keys | 1560 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 5 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1571105 keys | 4681 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 261908 keys | 780 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1309389 keys | 3901 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 5 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1571105 keys | 4681 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1571297 keys | 4681 slots | 1 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 4 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1571105 keys | 4681 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1571297 keys | 4681 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 785855 keys | 2341 slots | 0 slaves.
[OK] 5500000 keys in 4 masters.
335.69 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 781, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.199', slots: 781 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1833153 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1571297 keys | 4681 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 523807 keys | 1560 slots | 0 slaves.
[OK] 5500000 keys in 4 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.141', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1833153 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1571743 keys | 4681 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833348 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 261756 keys | 780 slots | 0 slaves.
[OK] 5500000 keys in 4 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.16', slots: 780 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1833153 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1833499 keys | 5461 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833348 keys | 5461 slots | 0 slaves.
[OK] 5500000 keys in 3 masters.
335.69 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.113:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.113:6379 18ce0ded73b106a39ba787811bc8776ededa500f
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1833153 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1833499 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833348 keys | 5461 slots | 0 slaves.
[OK] 5500000 keys in 3 masters.
335.69 keys per slot on average.
 
total slots: 16384
Removing node 18ce0ded73b106a39ba787811bc8776ededa500f from cluster 172.31.5.113:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1833153 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1833499 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833348 keys | 5461 slots | 0 slaves.
[OK] 5500000 keys in 3 masters.
335.69 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
[OK] 6000000 keys in 3 masters.
366.21 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6000000 keys in 4 masters.
366.21 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6000000 keys in 5 masters.
366.21 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6000000 keys in 6 masters.
366.21 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6000000 keys in 7 masters.
366.21 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion error.
 {
  keys1: 6000000,
  keys2: 5142327,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 7,
  nodes2: 7,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1999845 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2000174 keys | 5461 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1999981 keys | 5461 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6000000 keys in 7 masters.
366.21 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 857127 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 856780 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 857323 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 856860 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 857072 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 857165 keys | 2341 slots | 0 slaves.
[OK] 5142327 keys in 7 masters.
313.86 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 928378 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 928217 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 928829 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 928360 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928596 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 7 masters.
344.38 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 928378 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 928217 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 928829 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 928360 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928596 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 7 masters.
344.38 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 586 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 928217 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 696424 keys | 1755 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 928360 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928596 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 7 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 928217 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 464386 keys | 1170 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1160398 keys | 2925 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928596 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 7 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1160522 keys | 2925 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 232081 keys | 585 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1160398 keys | 2925 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928596 keys | 2341 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 7 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1160522 keys | 2925 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1160398 keys | 2925 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1160677 keys | 2926 slots | 1 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 6 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1160522 keys | 2925 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1160398 keys | 2925 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1160677 keys | 2926 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 928708 keys | 2341 slots | 0 slaves.
[OK] 5642327 keys in 6 masters.
344.38 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 586 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1160522 keys | 2925 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1160677 keys | 2926 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 696222 keys | 1755 slots | 0 slaves.
[OK] 5642327 keys in 6 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1392770 keys | 3510 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1160677 keys | 2926 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 463974 keys | 1170 slots | 0 slaves.
[OK] 5642327 keys in 6 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1160783 keys | 2926 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1392770 keys | 3510 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1392793 keys | 3511 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 231858 keys | 585 slots | 0 slaves.
[OK] 5642327 keys in 6 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1392641 keys | 3511 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1392770 keys | 3510 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1392793 keys | 3511 slots | 0 slaves.
[OK] 5642327 keys in 5 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1392641 keys | 3511 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1392770 keys | 3510 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 71239 keys | 2341 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1392793 keys | 3511 slots | 0 slaves.
[OK] 5642327 keys in 5 masters.
344.38 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 586 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1392641 keys | 3511 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 53443 keys | 1755 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1392793 keys | 3511 slots | 0 slaves.
[OK] 5642327 keys in 5 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.113', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1392641 keys | 3511 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 35709 keys | 1170 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1410527 keys | 4096 slots | 0 slaves.
[OK] 5642327 keys in 5 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1410553 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 17797 keys | 585 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1392884 keys | 3511 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1410527 keys | 4096 slots | 0 slaves.
[OK] 5642327 keys in 5 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 585 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1410553 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1410681 keys | 4096 slots | 1 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1410527 keys | 4096 slots | 0 slaves.
[OK] 5642327 keys in 4 masters.
344.38 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1410553 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1410681 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1410527 keys | 4096 slots | 0 slaves.
[OK] 5642327 keys in 4 masters.
344.38 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1410553 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1410566 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1410681 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1410527 keys | 4096 slots | 0 slaves.
[OK] 5642327 keys in 4 masters.
344.38 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1535704 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1535390 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1535677 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1535556 keys | 4096 slots | 0 slaves.
[OK] 6142327 keys in 4 masters.
374.90 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1535704 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1535390 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1535677 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1535556 keys | 4096 slots | 0 slaves.
[OK] 6142327 keys in 5 masters.
374.90 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1535704 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1535390 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1535677 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1535556 keys | 4096 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6142327 keys in 6 masters.
374.90 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1535704 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1535390 keys | 4096 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1535677 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1535556 keys | 4096 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 6142327 keys in 7 masters.
374.90 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 999782 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 999641 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 785976 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 929379 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 999754 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 856532 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 571263 keys | 2341 slots | 0 slaves.
[OK] 6142327 keys in 7 masters.
374.90 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1071025 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1071114 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 857522 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1071242 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928210 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1071025 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1071114 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 857522 keys | 2341 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1071242 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928210 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 469, 468, 468, 468, 468 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 469 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1071114 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 642696 keys | 1872 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1071242 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928210 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1071114 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 501324 keys | 1404 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1212614 keys | 2808 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928210 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1233342 keys | 2808 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 339096 keys | 936 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1212614 keys | 2808 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 928210 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1233342 keys | 2808 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 147263 keys | 468 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1000790 keys | 2342 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1212614 keys | 2808 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1120043 keys | 2808 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 7 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.154', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1233342 keys | 2808 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1148053 keys | 2810 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1212614 keys | 2808 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1120043 keys | 2808 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1233342 keys | 2808 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1148053 keys | 2810 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1212614 keys | 2808 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1120043 keys | 2808 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 642424 keys | 2341 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 469, 468, 468, 468, 468 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 469 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1233342 keys | 2808 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1148053 keys | 2810 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1120043 keys | 2808 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 599733 keys | 1872 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1148053 keys | 2810 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1120043 keys | 2808 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 428280 keys | 1404 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1148053 keys | 2810 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1334428 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 213895 keys | 936 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.154', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1285851 keys | 2809 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1319227 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1334428 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 42721 keys | 468 slots | 0 slaves.
[OK] 6642327 keys in 6 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 468 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1328572 keys | 3277 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1319227 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1334428 keys | 3276 slots | 0 slaves.
[OK] 6642327 keys in 5 masters.
405.42 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1328572 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1319227 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1334428 keys | 3276 slots | 0 slaves.
[OK] 6642327 keys in 5 masters.
405.42 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1328572 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1404795 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1319227 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1255305 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1334428 keys | 3276 slots | 0 slaves.
[OK] 6642327 keys in 5 masters.
405.42 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1428796 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1504823 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1419292 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1355310 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1434106 keys | 3276 slots | 0 slaves.
[OK] 7142327 keys in 5 masters.
435.93 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1428796 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1504823 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1419292 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1355310 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1434106 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 7142327 keys in 6 masters.
435.93 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1428796 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1504823 keys | 3276 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1419292 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1355310 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1434106 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 7142327 keys in 7 masters.
435.93 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1142622 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1142463 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 975337 keys | 2342 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 961221 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1142576 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 976994 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 801114 keys | 2342 slots | 0 slaves.
[OK] 7142327 keys in 7 masters.
435.93 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1214080 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1213816 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1046689 keys | 2342 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1213985 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1214080 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1213816 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1046689 keys | 2342 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1213985 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 391, 391, 390, 390, 390, 390 ] }
[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.199', slots: 391 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1373371 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1213816 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 887398 keys | 1951 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1213985 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.141', slots: 391 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1373371 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1213816 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 684550 keys | 1560 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.16', slots: 390 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1373371 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 482152 keys | 1170 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.113', slots: 390 }
assertion error.
 {
  keys1: 7642327,
  keys2: 6268956,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 7,
  nodes2: 7,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1373371 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 482152 keys | 1170 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1048378 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 7642327 keys in 7 masters.
466.45 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 294197 keys | 780 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1032700 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1236333 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 6268956 keys in 7 masters.
382.63 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.154', slots: 390 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 150379 keys | 390 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1176518 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1236333 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 872679 keys | 2342 slots | 0 slaves.
[OK] 6268956 keys in 7 masters.
382.63 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.87 TO 172.31.5.89 ###
[0m
{ reshardFrom: '172.31.5.87', reshardTo: '172.31.5.89', slots: 390 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1176518 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1236333 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1023058 keys | 2732 slots | 1 slaves.
[OK] 6268956 keys in 6 masters.
382.63 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.87:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.87:6379 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1176518 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1236333 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1023058 keys | 2732 slots | 0 slaves.
[OK] 6268956 keys in 6 masters.
382.63 keys per slot on average.
 
total slots: 16384
Removing node 8d88ab03bb631b5cf6591e91a3a6692ab429a6d7 from cluster 172.31.5.87:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1416214 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1176518 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1416833 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1236333 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1023058 keys | 2732 slots | 0 slaves.
[OK] 6268956 keys in 6 masters.
382.63 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 83203 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1499625 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1500262 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1106228 keys | 2732 slots | 0 slaves.
[OK] 6768956 keys in 6 masters.
413.14 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 83203 keys | 2731 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1499625 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1500262 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1106228 keys | 2732 slots | 0 slaves.
[OK] 6768956 keys in 6 masters.
413.14 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 911, 911, 910 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 911 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1499625 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1500262 keys | 2731 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 605743 keys | 1821 slots | 0 slaves.
[OK] 6768956 keys in 6 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 911 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1499625 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1829623 keys | 3642 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 276382 keys | 910 slots | 0 slaves.
[OK] 6768956 keys in 6 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1776007 keys | 3640 slots | 1 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1829623 keys | 3642 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 5 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1776007 keys | 3640 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1259804 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1829623 keys | 3642 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 5 masters.
413.14 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 910, 910, 910 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1776007 keys | 3640 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 767698 keys | 1820 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 5 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 583688 keys | 3642 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2153666 keys | 4550 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 390039 keys | 910 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 5 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 973727 keys | 4552 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2153666 keys | 4550 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 4 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 973727 keys | 4552 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2153666 keys | 4550 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319834 keys | 2730 slots | 0 slaves.
[OK] 6768956 keys in 4 masters.
413.14 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 910, 910, 910 ] }
[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.16', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 973727 keys | 4552 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2495950 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 977550 keys | 1820 slots | 0 slaves.
[OK] 6768956 keys in 4 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.199', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1473632 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2495950 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2321729 keys | 4552 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 477645 keys | 910 slots | 0 slaves.
[OK] 6768956 keys in 4 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.141', slots: 910 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1473632 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2495950 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2799374 keys | 5462 slots | 1 slaves.
[OK] 6768956 keys in 3 masters.
413.14 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.113:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.113:6379 18ce0ded73b106a39ba787811bc8776ededa500f
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1473632 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2495950 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2799374 keys | 5462 slots | 0 slaves.
[OK] 6768956 keys in 3 masters.
413.14 keys per slot on average.
 
total slots: 16384
Removing node 18ce0ded73b106a39ba787811bc8776ededa500f from cluster 172.31.5.113:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1473632 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2495950 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2799374 keys | 5462 slots | 0 slaves.
[OK] 6768956 keys in 3 masters.
413.14 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1640192 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2662595 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2966169 keys | 5462 slots | 0 slaves.
[OK] 7268956 keys in 3 masters.
443.66 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1640192 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2662595 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2966169 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 7268956 keys in 4 masters.
443.66 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1640192 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2662595 keys | 5460 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2966169 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 7268956 keys in 5 masters.
443.66 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1640192 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2662595 keys | 5460 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2966169 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 7268956 keys in 6 masters.
443.66 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 320691 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1439896 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1223255 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1583208 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1319501 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1382405 keys | 2731 slots | 0 slaves.
[OK] 7268956 keys in 6 masters.
443.66 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 403982 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1523197 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1666582 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1402813 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1465739 keys | 2731 slots | 0 slaves.
[OK] 7768956 keys in 6 masters.
474.18 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 403982 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1523197 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1666582 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1402813 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1465739 keys | 2731 slots | 0 slaves.
[OK] 7768956 keys in 6 masters.
474.18 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 683, 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1523197 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1666582 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1402813 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1227913 keys | 2048 slots | 0 slaves.
[OK] 7768956 keys in 6 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1523197 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2083369 keys | 3413 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1402813 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 811126 keys | 1365 slots | 0 slaves.
[OK] 7768956 keys in 6 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1940275 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2083369 keys | 3413 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1402813 keys | 2732 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 394048 keys | 682 slots | 0 slaves.
[OK] 7768956 keys in 6 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1940275 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2083369 keys | 3413 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1796861 keys | 3414 slots | 1 slaves.
[OK] 7768956 keys in 5 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1940275 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1306643 keys | 2731 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2083369 keys | 3413 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1796861 keys | 3414 slots | 0 slaves.
[OK] 7768956 keys in 5 masters.
474.18 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1940275 keys | 3413 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 953140 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1796861 keys | 3414 slots | 0 slaves.
[OK] 7768956 keys in 5 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2357019 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 536396 keys | 1365 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1796861 keys | 3414 slots | 0 slaves.
[OK] 7768956 keys in 5 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.113', slots: 683 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 641808 keys | 3413 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2357019 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 259969 keys | 682 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2073288 keys | 4097 slots | 0 slaves.
[OK] 7768956 keys in 5 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 682 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 901777 keys | 4095 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2357019 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2073288 keys | 4097 slots | 0 slaves.
[OK] 7768956 keys in 4 masters.
474.18 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 901777 keys | 4095 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2357019 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2073288 keys | 4097 slots | 0 slaves.
[OK] 7768956 keys in 4 masters.
474.18 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 901777 keys | 4095 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2357019 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2436872 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2073288 keys | 4097 slots | 0 slaves.
[OK] 7768956 keys in 4 masters.
474.18 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1026909 keys | 4095 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2482027 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2561730 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2198290 keys | 4097 slots | 0 slaves.
[OK] 8268956 keys in 4 masters.
504.70 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1026909 keys | 4095 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2482027 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2561730 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2198290 keys | 4097 slots | 0 slaves.
[OK] 8268956 keys in 5 masters.
504.70 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1026909 keys | 4095 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2482027 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2561730 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2198290 keys | 4097 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 8268956 keys in 6 masters.
504.70 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 472254 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1606507 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1548146 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1749806 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1524987 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1367256 keys | 2732 slots | 0 slaves.
[OK] 8268956 keys in 6 masters.
504.70 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 555559 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1689850 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833094 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1450599 keys | 2732 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 555559 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1689850 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833094 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1450599 keys | 2732 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 547, 547, 546, 546, 546 ] }
[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.199', slots: 547 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1689850 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 1833094 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1224579 keys | 2185 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.141', slots: 547 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1689850 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 894997 keys | 1638 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.16', slots: 546 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2001335 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583512 keys | 1092 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.113', slots: 546 }
assertion error.
 {
  keys1: 8768956,
  keys2: 6767622,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 6,
  nodes2: 6,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 2001335 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1608321 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 583512 keys | 1092 slots | 0 slaves.
[OK] 8768956 keys in 6 masters.
535.21 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1631533 keys | 2732 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1916680 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 275153 keys | 546 slots | 0 slaves.
[OK] 6767622 keys in 6 masters.
413.06 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.89 TO 172.31.5.154 ###
[0m
{ reshardFrom: '172.31.5.89', reshardTo: '172.31.5.154', slots: 546 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1906686 keys | 3278 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1916680 keys | 3276 slots | 0 slaves.
[OK] 6767622 keys in 5 masters.
413.06 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.89:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.89:6379 13d6fcab75d7d0bfa81c7832402ee8d04db3149c
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1906686 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1916680 keys | 3276 slots | 0 slaves.
[OK] 6767622 keys in 5 masters.
413.06 keys per slot on average.
 
total slots: 16384
Removing node 13d6fcab75d7d0bfa81c7832402ee8d04db3149c from cluster 172.31.5.89:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 781579 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1906686 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2162676 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1916680 keys | 3276 slots | 0 slaves.
[OK] 6767622 keys in 5 masters.
413.06 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 881669 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99999 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 2006762 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2262609 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 5 masters.
443.58 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 5 }
[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 881669 keys | 3277 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99999 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 2006762 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2262609 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 5 masters.
443.58 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 1093, 1093, 1092 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 1093 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99999 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1301193 keys | 2185 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2262609 keys | 3277 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 5 masters.
443.58 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 1093 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99999 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 675025 keys | 1092 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2888777 keys | 4370 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 5 masters.
443.58 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 1092 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 775024 keys | 4368 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2888777 keys | 4370 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 4 masters.
443.58 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 775024 keys | 4368 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2888777 keys | 4370 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 2016583 keys | 3276 slots | 0 slaves.
[OK] 7267622 keys in 4 masters.
443.58 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 1092, 1092, 1092 ] }
[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.141', slots: 1092 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 775024 keys | 4368 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 3542758 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1362602 keys | 2184 slots | 0 slaves.
[OK] 7267622 keys in 4 masters.
443.58 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.16', slots: 1092 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1455403 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 3542758 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 682223 keys | 1092 slots | 0 slaves.
[OK] 7267622 keys in 4 masters.
443.58 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.199', slots: 1092 }
assertion error.
 {
  keys1: 7267622,
  keys2: 3196100,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 4,
  nodes2: 3,
  nodes: -1
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1587238 keys | 4370 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1455403 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 3542758 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 682223 keys | 1092 slots | 0 slaves.
[OK] 7267622 keys in 4 masters.
443.58 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1740695 keys | 5462 slots | 1 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1455403 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2 keys | 5462 slots | 0 slaves.
[OK] 3196100 keys in 3 masters.
195.07 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.113:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.113:6379 18ce0ded73b106a39ba787811bc8776ededa500f
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1740695 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1455403 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2 keys | 5462 slots | 0 slaves.
[OK] 3196100 keys in 3 masters.
195.07 keys per slot on average.
 
total slots: 16384
Removing node 18ce0ded73b106a39ba787811bc8776ededa500f from cluster 172.31.5.113:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1740695 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1455403 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 2 keys | 5462 slots | 0 slaves.
[OK] 3196100 keys in 3 masters.
195.07 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1907619 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1621990 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166491 keys | 5462 slots | 0 slaves.
[OK] 3696100 keys in 3 masters.
225.59 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1907619 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1621990 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166491 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3696100 keys in 4 masters.
225.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1907619 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1621990 keys | 5460 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166491 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3696100 keys in 5 masters.
225.59 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion error.
 {
  keys1: 3696100,
  keys2: 1907620,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 5,
  nodes2: 5,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1907619 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1621990 keys | 5460 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 166491 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3696100 keys in 5 masters.
225.59 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 738959 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 1 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 0 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1168660 keys | 3278 slots | 0 slaves.
[OK] 1907620 keys in 5 masters.
116.43 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 5 nodes. Total weight = 5.00



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 838944 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99899 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 100125 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 99969 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1268683 keys | 3278 slots | 0 slaves.
[OK] 2407620 keys in 5 masters.
146.95 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 5 }
[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 838944 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99899 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 100125 keys | 3278 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 99969 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1268683 keys | 3278 slots | 0 slaves.
[OK] 2407620 keys in 5 masters.
146.95 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 820, 820, 819, 819 ] }
[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.199', slots: 820 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99899 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 74956 keys | 2458 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 99969 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1268683 keys | 3278 slots | 0 slaves.
[OK] 2407620 keys in 5 masters.
146.95 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.141', slots: 820 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 99899 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 49971 keys | 1638 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124954 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1268683 keys | 3278 slots | 0 slaves.
[OK] 2407620 keys in 5 masters.
146.95 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.16', slots: 819 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 124877 keys | 4095 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 24993 keys | 819 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124954 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1268683 keys | 3278 slots | 0 slaves.
[OK] 2407620 keys in 5 masters.
146.95 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.154 TO 172.31.5.113 ###
[0m
{ reshardFrom: '172.31.5.154', reshardTo: '172.31.5.113', slots: 819 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 124877 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124954 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1293676 keys | 4097 slots | 1 slaves.
[OK] 2407620 keys in 4 masters.
146.95 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.154:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.154:6379 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 124877 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124954 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1293676 keys | 4097 slots | 0 slaves.
[OK] 2407620 keys in 4 masters.
146.95 keys per slot on average.
 
total slots: 16384
Removing node 20733dcc8ee8c1d33b1bcf3ee24a063e47b98f1e from cluster 172.31.5.154:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 864113 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 124877 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 124954 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1293676 keys | 4097 slots | 0 slaves.
[OK] 2407620 keys in 4 masters.
146.95 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 989300 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 249766 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249771 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1418783 keys | 4097 slots | 0 slaves.
[OK] 2907620 keys in 4 masters.
177.47 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 4 }
[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 989300 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 249766 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249771 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1418783 keys | 4097 slots | 0 slaves.
[OK] 2907620 keys in 4 masters.
177.47 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 1366, 1366, 1365 ] }
[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.199 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.199', slots: 1366 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1958745 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 249766 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 249771 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 449338 keys | 2731 slots | 0 slaves.
[OK] 2907620 keys in 4 masters.
177.47 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.141 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.141', slots: 1366 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1958745 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 249766 keys | 4095 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 445569 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 253540 keys | 1365 slots | 0 slaves.
[OK] 2907620 keys in 4 masters.
177.47 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.113 TO 172.31.5.16 ###
[0m
{ reshardFrom: '172.31.5.113', reshardTo: '172.31.5.16', slots: 1365 }
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1958745 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 503306 keys | 5460 slots | 1 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 445569 keys | 5462 slots | 0 slaves.
[OK] 2907620 keys in 3 masters.
177.47 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.113:6379 FROM CLUSTER ###
[0m
> redis-cli --cluster del-node 172.31.5.113:6379 18ce0ded73b106a39ba787811bc8776ededa500f
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1958745 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 503306 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 445569 keys | 5462 slots | 0 slaves.
[OK] 2907620 keys in 3 masters.
177.47 keys per slot on average.
 
total slots: 16384
Removing node 18ce0ded73b106a39ba787811bc8776ededa500f from cluster 172.31.5.113:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.199:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.199:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1958745 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 503306 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 445569 keys | 5462 slots | 0 slaves.
[OK] 2907620 keys in 3 masters.
177.47 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 2125054 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 669988 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 612578 keys | 5462 slots | 0 slaves.
[OK] 3407620 keys in 3 masters.
207.98 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.113:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.113:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 2125054 keys | 5462 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 669988 keys | 5460 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 612578 keys | 5462 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 0 keys | 0 slots | 0 slaves.
[OK] 3407620 keys in 4 masters.
207.98 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.113:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.113:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1114005 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 545135 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 374940 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1373540 keys | 4096 slots | 0 slaves.
[OK] 3407620 keys in 4 masters.
207.98 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 4 nodes. Total weight = 4.00



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1238924 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 670160 keys | 4096 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499983 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1498553 keys | 4096 slots | 0 slaves.
[OK] 3907620 keys in 4 masters.
238.50 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.154:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.154:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1238924 keys | 4096 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 670160 keys | 4096 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499983 keys | 4096 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 1498553 keys | 4096 slots | 0 slaves.
[OK] 3907620 keys in 5 masters.
238.50 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.154:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.154:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1138820 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 409833 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1161294 keys | 3280 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 399900 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 797773 keys | 3276 slots | 0 slaves.
[OK] 3907620 keys in 5 masters.
238.50 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 5 nodes. Total weight = 5.00



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1238814 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 509828 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1261517 keys | 3280 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499840 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 897621 keys | 3276 slots | 0 slaves.
[OK] 4407620 keys in 5 masters.
269.02 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.89:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.89:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1238814 keys | 3276 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 509828 keys | 3276 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 1261517 keys | 3280 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499840 keys | 3276 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 897621 keys | 3276 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 0 keys | 0 slots | 0 slaves.
[OK] 4407620 keys in 6 masters.
269.02 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.89:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.89:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1139050 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 416497 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 774192 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 416498 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 528993 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1132390 keys | 2734 slots | 0 slaves.
[OK] 4407620 keys in 6 masters.
269.02 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1222519 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 499815 keys | 2730 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 857534 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499650 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 612079 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1216023 keys | 2734 slots | 0 slaves.
[OK] 4907620 keys in 6 masters.
299.54 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 6 }
[33m### ADDING 172.31.5.87:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.87:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1222519 keys | 2730 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 499815 keys | 2730 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 857534 keys | 2730 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499650 keys | 2730 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 612079 keys | 2730 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 1216023 keys | 2734 slots | 0 slaves.
[OK] 4907620 keys in 7 masters.
299.54 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.87:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.87:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 928631 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 428214 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1204455 keys | 2344 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 588817 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 428408 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 474284 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 854811 keys | 2340 slots | 0 slaves.
[OK] 4907620 keys in 7 masters.
299.54 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1000192 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 499558 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1276059 keys | 2344 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 660202 keys | 2340 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499747 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 545590 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 926272 keys | 2340 slots | 0 slaves.
[OK] 5407620 keys in 7 masters.
330.05 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 7 }
[33m### ADDING 172.31.5.157:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster add-node 172.31.5.157:6379 172.31.5.199:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 1000192 keys | 2340 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 499558 keys | 2340 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1276059 keys | 2344 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 660202 keys | 2340 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499747 keys | 2340 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 545590 keys | 2340 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 926272 keys | 2340 slots | 0 slaves.
[OK] 5407620 keys in 8 masters.
330.05 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.157:6379 ###
[0m
> redis-cli --cluster rebalance 172.31.5.157:6379 --cluster-use-empty-masters | grep -i Rebalancing
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 875793 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 437487 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 995581 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 597606 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 930527 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 437167 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 483561 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 649898 keys | 2048 slots | 0 slaves.
[OK] 5407620 keys in 8 masters.
330.05 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 500000 *******[0m

[33m### WRITING 500000 KEYS ###
[0m
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.199:6379 ###
[0m172.31.5.199:6379 (d0515733...) -> 938213 keys | 2048 slots | 0 slaves.
172.31.5.16:6379 (70ab02cf...) -> 499973 keys | 2048 slots | 0 slaves.
172.31.5.87:6379 (8d88ab03...) -> 1058040 keys | 2048 slots | 0 slaves.
172.31.5.154:6379 (20733dcc...) -> 660129 keys | 2048 slots | 0 slaves.
172.31.5.157:6379 (fbf49716...) -> 993064 keys | 2048 slots | 0 slaves.
172.31.5.141:6379 (b9d0c0b5...) -> 499731 keys | 2048 slots | 0 slaves.
172.31.5.113:6379 (18ce0ded...) -> 546089 keys | 2048 slots | 0 slaves.
172.31.5.89:6379 (13d6fcab...) -> 712381 keys | 2048 slots | 0 slaves.
[OK] 5907620 keys in 8 masters.
360.57 keys per slot on average.
 
total slots: 16384
0.5M keys written successfully

[34m******* write , 500000 completed ******* [0m 

Time Taken: 33913.749 seconds...

---DONE---
