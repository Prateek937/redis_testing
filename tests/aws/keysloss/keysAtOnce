> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | wc -l
cluster Size: 1
------------------------------------------------------------------

[34m******* init  *******[0m

[33m### CREATING CLUSTER OF 3 NODES  172.31.5.107:6379 172.31.5.4:6379 172.31.5.169:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster create  172.31.5.107:6379 172.31.5.4:6379 172.31.5.169:6379 --cluster-replicas 0 --cluster-yes | grep OK | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 0,
  keys2: 0,
  keys: 0,
  slots1: 0,
  slots2: 16384,
  nodes1: 1,
  nodes2: 3,
  nodes: 2
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 0 keys | 0 slots | 0 slaves.
[OK] 0 keys in 1 masters.
0.00 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 0 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 5462 slots | 0 slaves.
[OK] 0 keys in 3 masters.
0.00 keys per slot on average.
 
total slots: 16384
cluster created successfully

[34m******* init  completed ******* [0m 

------------------------------------------------------------------

[34m******* write , 15000000 *******[0m

[33m### WRITING 15000000 KEYS ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
[OK] 15000000 keys in 3 masters.
915.53 keys per slot on average.
 
total slots: 16384
15M keys written successfully

[34m******* write , 15000000 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
[OK] 15000000 keys in 4 masters.
915.53 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
[OK] 15000000 keys in 5 masters.
915.53 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
[OK] 15000000 keys in 7 masters.
915.53 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999365 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5000954 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 4999681 keys | 5461 slots | 0 slaves.
[OK] 15000000 keys in 8 masters.
915.53 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1875131 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1874590 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1875028 keys | 2048 slots | 0 slaves.
[OK] 15000000 keys in 8 masters.
915.53 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1875131 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1874590 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1875028 keys | 2048 slots | 0 slaves.
[OK] 15000000 keys in 8 masters.
915.53 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.107', slots: 683 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1875131 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1249737 keys | 1365 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1875028 keys | 2048 slots | 0 slaves.
[OK] 15000000 keys in 8 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2500583 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 624285 keys | 682 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1875028 keys | 2048 slots | 0 slaves.
[OK] 15000000 keys in 8 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.169', slots: 682 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2500583 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2499313 keys | 2730 slots | 1 slaves.
[OK] 15000000 keys in 7 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.69:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.69:6379 9141b753bc7682372d6812f08091dc3a09384b28
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2500583 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874957 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2499313 keys | 2730 slots | 0 slaves.
[OK] 15000000 keys in 7 masters.
915.53 keys per slot on average.
 
total slots: 16384
Removing node 9141b753bc7682372d6812f08091dc3a09384b28 from cluster 172.31.5.69:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1249414 keys | 1365 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2499313 keys | 2730 slots | 0 slaves.
[OK] 15000000 keys in 7 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 683 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2499832 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 624463 keys | 682 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3124264 keys | 3413 slots | 0 slaves.
[OK] 15000000 keys in 7 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 682 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3124295 keys | 3413 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3124264 keys | 3413 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3124295 keys | 3413 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875077 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3124264 keys | 3413 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 683 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3124295 keys | 3413 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249812 keys | 1365 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3749529 keys | 4096 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 683 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3749628 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 624479 keys | 682 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3749529 keys | 4096 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 682 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 15000000,
  keys2: 11250472,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 6,
  nodes2: 5,
  nodes: -1
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3749628 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3126126 keys | 3414 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 624479 keys | 682 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 3749529 keys | 4096 slots | 0 slaves.
[OK] 15000000 keys in 6 masters.
915.53 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3749628 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3750605 keys | 4096 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3749628 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3750605 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1875266 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 683 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3750605 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1249605 keys | 1365 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 4375795 keys | 4779 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 624415 keys | 682 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 682 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 4375795 keys | 4779 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 624416 keys | 4778 slots | 1 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 4375795 keys | 4779 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1874972 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 624416 keys | 4778 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1249366 keys | 1365 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 624416 keys | 4778 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.169', slots: 683 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4375289 keys | 4779 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 624375 keys | 682 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.107', slots: 682 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 3 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.143:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.143:6379 d509fa176b56044326d8474f9d5202417d1ee33f
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 3 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node d509fa176b56044326d8474f9d5202417d1ee33f from cluster 172.31.5.143:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 3 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4999664 keys | 5461 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 5001401 keys | 5462 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1249407 keys | 5461 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1875369 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874964 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1249316 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 2048 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1875369 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874964 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1249316 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 2048 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.107', slots: 512 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874964 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 780848 keys | 1536 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 2048 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.4', slots: 512 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2343913 keys | 2560 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 311899 keys | 1024 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1 keys | 2048 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.169', slots: 512 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2343913 keys | 2560 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 512 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 311900 keys | 2560 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.143', slots: 512 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2560 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2343913 keys | 2560 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 311900 keys | 2560 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.69:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.69:6379 9141b753bc7682372d6812f08091dc3a09384b28
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2560 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2343913 keys | 2560 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874979 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 311900 keys | 2560 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 9141b753bc7682372d6812f08091dc3a09384b28 from cluster 172.31.5.69:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 512 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2560 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1406234 keys | 1536 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 311900 keys | 2560 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 512 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1875725 keys | 2560 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 937386 keys | 1024 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 780748 keys | 3072 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 512 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2343837 keys | 2560 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2344462 keys | 3072 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 468649 keys | 512 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 780748 keys | 3072 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 512 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2812486 keys | 3072 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 2344462 keys | 3072 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 780748 keys | 3072 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2812486 keys | 3072 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2344462 keys | 3072 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1249406 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 780748 keys | 3072 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 512 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2812486 keys | 3072 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2344462 keys | 3072 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 781855 keys | 1536 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 512 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2812486 keys | 3072 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 3584 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 313230 keys | 1024 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 512 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3125716 keys | 3584 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 3584 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3072 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 512 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 512 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3125716 keys | 3584 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 3584 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3584 slots | 1 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3125716 keys | 3584 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 3584 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3584 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 512, 512, 512, 512 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.143', slots: 512 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3125716 keys | 3584 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3584 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1250712 keys | 1536 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 512 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2812658 keys | 3584 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 937488 keys | 1024 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 512 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 468924 keys | 512 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1248299 keys | 3584 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 512 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 512 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 1 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 4 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 11250472,
  keys2: 11250471,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 8,
  nodes2: 8,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3438940 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2813087 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 3281222 keys | 4096 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1717223 keys | 4096 slots | 0 slaves.
[OK] 11250472 keys in 8 masters.
686.67 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719857 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406480 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1719083 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719857 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406480 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1719083 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.107', slots: 410 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406480 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1344123 keys | 1638 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.4', slots: 410 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406480 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1626488 keys | 2458 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1124040 keys | 1228 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.169', slots: 410 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406480 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1626488 keys | 2458 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 748965 keys | 818 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 375075 keys | 2458 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.143', slots: 409 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1780944 keys | 2457 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1626488 keys | 2458 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1717222 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 374501 keys | 409 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 375075 keys | 2458 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.17', slots: 409 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1780944 keys | 2457 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1626488 keys | 2458 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2091723 keys | 2457 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 375075 keys | 2458 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.69:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.69:6379 9141b753bc7682372d6812f08091dc3a09384b28
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1780944 keys | 2457 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1626488 keys | 2458 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1874817 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2091723 keys | 2457 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 375075 keys | 2458 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 9141b753bc7682372d6812f08091dc3a09384b28 from cluster 172.31.5.69:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 410 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1780944 keys | 2457 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1499419 keys | 1638 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2091723 keys | 2457 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 375075 keys | 2458 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 410 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1780944 keys | 2457 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1124033 keys | 1228 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2091723 keys | 2457 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 750461 keys | 2868 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 410 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2156459 keys | 2867 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 748518 keys | 818 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2091723 keys | 2457 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 750461 keys | 2868 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.17', slots: 409 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2094817 keys | 2458 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2156459 keys | 2867 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 374264 keys | 409 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2465977 keys | 2866 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 750461 keys | 2868 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 409 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2469081 keys | 2867 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 2156459 keys | 2867 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2465977 keys | 2866 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 750461 keys | 2868 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2469081 keys | 2867 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2156459 keys | 2867 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1406607 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2465977 keys | 2866 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 750461 keys | 2868 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 410, 410, 410, 409, 409 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 410 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2469081 keys | 2867 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2156459 keys | 2867 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1030918 keys | 1638 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2465977 keys | 2866 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 410 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2469081 keys | 2867 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 655721 keys | 1228 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2465977 keys | 2866 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.17', slots: 410 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 410 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2469081 keys | 2867 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 280358 keys | 818 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 409 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2001886 keys | 2868 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 156488 keys | 409 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 409 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 409 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 1 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 5 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 6 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2592951 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2531656 keys | 3277 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2158374 keys | 3277 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2841340 keys | 3276 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1126150 keys | 3278 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719597 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1622966 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719597 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1622966 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 342, 342, 341, 341, 341, 341 ] }
[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.107', slots: 342 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 342 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1406405 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1310120 keys | 1706 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.4', slots: 342 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 342 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1122360 keys | 1364 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.169', slots: 341 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 936772 keys | 1023 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.143', slots: 341 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718141 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 624329 keys | 682 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.17', slots: 341 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1874939 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 312446 keys | 341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 8 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.50 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.50', slots: 341 }
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 1 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.69:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.69:6379 9141b753bc7682372d6812f08091dc3a09384b28
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1594165 keys | 2390 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1501873 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
Removing node 9141b753bc7682372d6812f08091dc3a09384b28 from cluster 172.31.5.69:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 342, 342, 341, 341, 341, 341 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 342 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 342 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1907091 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1188947 keys | 1706 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 342 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 342 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 11250471,
  keys2: 9343380,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 7,
  nodes2: 7,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1907091 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1188947 keys | 1706 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 185588 keys | 2389 slots | 0 slaves.
[OK] 11250471 keys in 7 masters.
686.67 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2389 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 878393 keys | 1364 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 341 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 878393 keys | 1023 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2030024 keys | 2389 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.17', slots: 341 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 624732 keys | 682 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2187385 keys | 2389 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.50 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.50', slots: 341 }
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2032443 keys | 2390 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 312251 keys | 341 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 341 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 341 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2344694 keys | 2731 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2344694 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2344694 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 6 }
[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2344694 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2344694 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1718993 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2732 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2499866 keys | 2730 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2283685 keys | 2730 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 496142 keys | 2731 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719597 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1504427 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 8 }
[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1719597 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1504427 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [
    293, 293, 293,
    293, 292, 292,
    292
  ] }
[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.107', slots: 293 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 293 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 1235824 keys | 1755 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.4', slots: 293 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 293 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 967712 keys | 1462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.169', slots: 293 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 293 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1406550 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 879851 keys | 1169 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.143', slots: 293 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 293 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1718034 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 801800 keys | 876 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.17', slots: 292 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 292 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1875290 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 534527 keys | 584 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.50 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.50', slots: 292 }
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-slots 292 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1119482 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 267080 keys | 292 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 8 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.69 TO 172.31.5.251 ###
[0m
{ reshardFrom: '172.31.5.69', reshardTo: '172.31.5.251', slots: 292 }
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.69:6379 --cluster-from 9141b753bc7682372d6812f08091dc3a09384b28 --cluster-to 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-slots 292 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1386562 keys | 2340 slots | 1 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.69:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.69 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.69:6379 9141b753bc7682372d6812f08091dc3a09384b28
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1386562 keys | 2340 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node 9141b753bc7682372d6812f08091dc3a09384b28 from cluster 172.31.5.69:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1386562 keys | 2340 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1988200 keys | 2341 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1386562 keys | 2340 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 780 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 268112 keys | 2341 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1047922 keys | 1560 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 780 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 602197 keys | 3121 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 713837 keys | 780 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 87861 keys | 2341 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 780 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 602197 keys | 3121 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 801698 keys | 3121 slots | 1 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 602197 keys | 3121 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 2142737 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 801698 keys | 3121 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 780 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1428330 keys | 1560 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 801698 keys | 3121 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 780 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2326840 keys | 3121 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 714010 keys | 780 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1516018 keys | 3901 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 780 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3040850 keys | 3901 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1516018 keys | 3901 slots | 0 slaves.
[OK] 9343380 keys in 5 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3040850 keys | 3901 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1985307 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 1516018 keys | 3901 slots | 0 slaves.
[OK] 9343380 keys in 5 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 780, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 780 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3040850 keys | 3901 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1271311 keys | 1560 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 5 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 780 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3754518 keys | 4681 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1316604 keys | 3901 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 557643 keys | 780 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 5 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 780 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3754518 keys | 4681 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874247 keys | 4681 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 4 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3754518 keys | 4681 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1484601 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874247 keys | 4681 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 4 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 781, 780, 780 ] }
[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.107', slots: 781 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 781 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 959433 keys | 1560 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1874247 keys | 4681 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 4 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.4', slots: 780 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 245346 keys | 780 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2230014 keys | 4681 slots | 0 slaves.
[OK] 9343380 keys in 4 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.169', slots: 780 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 780 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 1 slaves.
[OK] 9343380 keys in 3 masters.
570.27 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.143:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.143:6379 d509fa176b56044326d8474f9d5202417d1ee33f
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 3 masters.
570.27 keys per slot on average.
 
total slots: 16384
Removing node d509fa176b56044326d8474f9d5202417d1ee33f from cluster 172.31.5.143:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 3 masters.
570.27 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 4 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 5 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 6 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 9343380,
  keys2: 8164106,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 7,
  nodes2: 7,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 4279686 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 2588334 keys | 5461 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 2475360 keys | 5461 slots | 0 slaves.
[OK] 9343380 keys in 7 masters.
570.27 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1577961 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 619163 keys | 2341 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1577961 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 619163 keys | 2341 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 586 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 586 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1577961 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 619163 keys | 1755 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 585 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1577961 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2925 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 619163 keys | 1170 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 585 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1577961 keys | 2341 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2925 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 535776 keys | 585 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 83387 keys | 2925 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 585 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2113737 keys | 2926 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2925 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 83387 keys | 2925 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2113737 keys | 2926 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2925 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1907158 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 83387 keys | 2925 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 586 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 586 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2113737 keys | 2926 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1370913 keys | 1755 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 83387 keys | 2925 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 585 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2113737 keys | 2926 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 869570 keys | 1170 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 584730 keys | 3510 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 585 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1986701 keys | 2926 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2648874 keys | 3511 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 334433 keys | 585 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 584730 keys | 3510 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 585 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2321134 keys | 3511 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 2648874 keys | 3511 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 584730 keys | 3510 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2321134 keys | 3511 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2648874 keys | 3511 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1962408 keys | 2341 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 584730 keys | 3510 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 586, 585, 585, 585 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 586 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 586 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2321134 keys | 3511 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2648874 keys | 3511 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1606324 keys | 1755 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.143', slots: 585 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2321134 keys | 3511 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1071170 keys | 1170 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 585 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 646960 keys | 3511 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 535950 keys | 585 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 585 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 585 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 4 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 4 masters.
498.30 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 4 masters.
498.30 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2856354 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 3184028 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1182910 keys | 4096 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 940814 keys | 4096 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2141780 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1071635 keys | 2341 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2141780 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1071635 keys | 2341 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 469, 468, 468, 468, 468 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 469 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 469 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2141780 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1071635 keys | 1872 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 468 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2141780 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2808 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1071635 keys | 1404 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 468 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2141780 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2808 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 767533 keys | 936 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 304102 keys | 2808 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 468 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2480359 keys | 2808 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2808 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 428954 keys | 468 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1477059 keys | 2342 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 304102 keys | 2808 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.17', slots: 468 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2480359 keys | 2808 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2808 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1906013 keys | 2810 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 304102 keys | 2808 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2480359 keys | 2808 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2808 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1577741 keys | 2341 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1906013 keys | 2810 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 304102 keys | 2808 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 469, 468, 468, 468, 468 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 469 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 469 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2480359 keys | 2808 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1264895 keys | 1872 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1906013 keys | 2810 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 304102 keys | 2808 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 468 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2480359 keys | 2808 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1032278 keys | 1404 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1906013 keys | 2810 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 468 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 856919 keys | 936 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1906013 keys | 2810 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.17', slots: 468 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2809 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 428661 keys | 468 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 468 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 468 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 5 masters.
498.30 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 6 masters.
498.30 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion error.
 {
  keys1: 8164106,
  keys2: 5508388,
  keys: 0,
  slots1: 16384,
  slots2: 16384,
  nodes1: 7,
  nodes2: 7,
  nodes: 0
}
precheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2213837 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 2655718 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 423561 keys | 3277 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 2334271 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 536719 keys | 3276 slots | 0 slaves.
[OK] 8164106 keys in 7 masters.
498.30 keys per slot on average.

postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 965380 keys | 2342 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 7 }
[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1785176 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 965380 keys | 2342 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 391, 391, 390, 390, 390, 390 ] }
[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.107', slots: 391 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 391 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 110715 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 803048 keys | 1951 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.4', slots: 391 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 391 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 732763 keys | 1560 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.169', slots: 390 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 390 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 732763 keys | 1170 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.143', slots: 390 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 390 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 464534 keys | 780 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1567228 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.17', slots: 390 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 390 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 357067 keys | 390 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1079889 keys | 2342 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 7 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.251 TO 172.31.5.50 ###
[0m
{ reshardFrom: '172.31.5.251', reshardTo: '172.31.5.50', slots: 390 }
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.251:6379 --cluster-from 068fb74f972ab2f08508eec07f5f81397c9c6829 --cluster-to e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-slots 390 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1436956 keys | 2732 slots | 1 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 6 masters.
336.21 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.251:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.251 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.251:6379 068fb74f972ab2f08508eec07f5f81397c9c6829
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1436956 keys | 2732 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 6 masters.
336.21 keys per slot on average.
 
total slots: 16384
Removing node 068fb74f972ab2f08508eec07f5f81397c9c6829 from cluster 172.31.5.251:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 181000 keys | 2731 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1436956 keys | 2732 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5508388 keys in 6 masters.
336.21 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1947508 keys | 2731 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1436956 keys | 2732 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 911, 911, 910 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 911 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 911 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2731 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 719816 keys | 1821 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 911 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 911 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 362749 keys | 3642 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 357067 keys | 910 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 910 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 362749 keys | 3642 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 3640 slots | 1 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 362749 keys | 3642 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1674695 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 3640 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 910, 910, 910 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 910 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1017010 keys | 1820 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 3640 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 910 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2664648 keys | 3642 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 690767 keys | 910 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 683310 keys | 4550 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 910 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 4552 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 683310 keys | 4550 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 4552 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 268229 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 683310 keys | 4550 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 910, 910, 910 ] }
[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.169', slots: 910 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 4552 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 1820 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.107', slots: 910 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 910 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 4552 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.4', slots: 910 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 910 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.143:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.143:6379 d509fa176b56044326d8474f9d5202417d1ee33f
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node d509fa176b56044326d8474f9d5202417d1ee33f from cluster 172.31.5.143:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3355415 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1020434 keys | 5462 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 951539 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1295387 keys | 2732 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 594472 keys | 2731 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1295387 keys | 2732 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 594472 keys | 2731 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 683, 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 683 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1295387 keys | 2732 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 594472 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1295387 keys | 2732 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 328741 keys | 3413 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 265731 keys | 1365 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 683 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1295387 keys | 2732 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 328741 keys | 3413 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 9239 keys | 682 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 3413 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 682 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1304626 keys | 3414 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 328741 keys | 3413 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 3413 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1304626 keys | 3414 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 328741 keys | 3413 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1020434 keys | 2731 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 3413 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 683, 683, 683, 682 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 683 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1304626 keys | 3414 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 657685 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 3413 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 683 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1304626 keys | 3414 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 657685 keys | 1365 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.143', slots: 683 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 683 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2060028 keys | 3413 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 97348 keys | 682 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 682 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 682 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2157376 keys | 4095 slots | 1 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2157376 keys | 4095 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2157376 keys | 4095 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2157376 keys | 4095 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2157376 keys | 4095 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1864963 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 691490 keys | 4096 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 613559 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1882427 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 956153 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 967375 keys | 2732 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 6 }
[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1882427 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 956153 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 967375 keys | 2732 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 547, 547, 546, 546, 546 ] }
[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.107', slots: 547 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 547 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 956153 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 661570 keys | 2185 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.4', slots: 547 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 547 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 956153 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 604626 keys | 1638 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.169', slots: 546 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 546 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 956153 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 575314 keys | 1092 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.143', slots: 546 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 546 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 202396 keys | 546 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1164366 keys | 2732 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.50 TO 172.31.5.17 ###
[0m
{ reshardFrom: '172.31.5.50', reshardTo: '172.31.5.17', slots: 546 }
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.50:6379 --cluster-from e5a4e8acfbf57d06a32a7349bfda395e45f7a680 --cluster-to 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-slots 546 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1366762 keys | 3278 slots | 1 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.50:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.50 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.50:6379 e5a4e8acfbf57d06a32a7349bfda395e45f7a680
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1366762 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node e5a4e8acfbf57d06a32a7349bfda395e45f7a680 from cluster 172.31.5.50:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1366762 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 5 }
[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2188232 keys | 3277 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1366762 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 1093, 1093, 1092 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 1093 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 1093 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 56944 keys | 3277 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 678531 keys | 2185 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 1093 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 1093 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 402215 keys | 4370 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 333260 keys | 1092 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 386379 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 1092 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 1092 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 402215 keys | 4370 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 719639 keys | 4368 slots | 1 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1329071 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 402215 keys | 4370 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 719639 keys | 4368 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
{ distribution: [ 1092, 1092, 1092 ] }
[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.4', slots: 1092 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 1092 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 491164 keys | 2184 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 719639 keys | 4368 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.169', slots: 1092 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 1092 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2876463 keys | 4370 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 415915 keys | 1092 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.107', slots: 1092 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 1092 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3292378 keys | 5462 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.143:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.143:6379 d509fa176b56044326d8474f9d5202417d1ee33f
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3292378 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node d509fa176b56044326d8474f9d5202417d1ee33f from cluster 172.31.5.143:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3292378 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3292378 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3292378 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1240122 keys | 5462 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 794888 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2298342 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 3278 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 431600 keys | 3276 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 820557 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 5 nodes. Total weight = 5.00



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 5 }
[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2298342 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 3278 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 431600 keys | 3276 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 820557 keys | 3278 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 820, 820, 819, 819 ] }
[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.107', slots: 820 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 820 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 3278 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 431600 keys | 3276 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 452549 keys | 2458 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.4', slots: 820 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 820 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 3278 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 230908 keys | 1638 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.169', slots: 819 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 819 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 3278 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 819 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.17 TO 172.31.5.143 ###
[0m
{ reshardFrom: '172.31.5.17', reshardTo: '172.31.5.143', slots: 819 }
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.17:6379 --cluster-from 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 --cluster-to d509fa176b56044326d8474f9d5202417d1ee33f --cluster-slots 819 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 4097 slots | 1 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.17:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.17 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.17:6379 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node 4dbdb61a3ca9405ff8d6dd445709a3344f38edf5 from cluster 172.31.5.17:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 3 *******[0m

{ clusterSize: 4 }
[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1242221 keys | 4097 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


{ distribution: [ 1366, 1366, 1365 ] }
[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.107 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.107', slots: 1366 }
> redis-cli -h 172.31.5.107 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to c5743b691eb8dedbde2aa49b7e772ed2b2679895 --cluster-slots 1366 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 410163 keys | 2731 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.4 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.4', slots: 1366 }
> redis-cli -h 172.31.5.4 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to 58f8a9e3dc287eee35b4bc9396fec0429c93b0a5 --cluster-slots 1366 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 1365 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1063404 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 4095 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### RESHARDING FROM 172.31.5.143 TO 172.31.5.169 ###
[0m
{ reshardFrom: '172.31.5.143', reshardTo: '172.31.5.169', slots: 1365 }
> redis-cli -h 172.31.5.169 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER NODES | grep myself | cut -d" " -f1
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster reshard 172.31.5.143:6379 --cluster-from d509fa176b56044326d8474f9d5202417d1ee33f --cluster-to bc2140abf5fb37fae86d179038b1b11eb1e46e8f --cluster-slots 1365 --cluster-yes | grep Ready
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1063404 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 5460 slots | 1 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
resharded successfully!
waiting... 2 1 


[33m### REMOVING 172.31.5.143:6379 FROM CLUSTER ###
[0m
> redis-cli -h 172.31.5.143 -p 6379 CLUSTER MYID
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster del-node 172.31.5.143:6379 d509fa176b56044326d8474f9d5202417d1ee33f
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1063404 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
Removing node d509fa176b56044326d8474f9d5202417d1ee33f from cluster 172.31.5.143:6379
Sending CLUSTER FORGET messages to the cluster...
Sending CLUSTER RESET SOFT to the deleted node.
[33m### REBALANCING CLUSTER ON 172.31.5.107:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.107:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1063404 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 3 masters.
325.16 keys per slot on average.
 
total slots: 16384
*** No rebalancing needed! All nodes are within the 2.00% threshold.


waiting... 65 64 63 62 61 60 59 58 57 56 55 54 53 52 51 50 49 48 47 46 45 44 43 42 41 40 39 38 37 36 35 34 33 32 31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 



[34m******* resize , 3 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 4 *******[0m

{ clusterSize: 3 }
[33m### ADDING 172.31.5.143:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.143:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 3498408 keys | 5462 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 1063404 keys | 5462 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 765576 keys | 5460 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.143:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.143:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1473129 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 4 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 4 nodes. Total weight = 4.00



[34m******* resize , 4 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 5 *******[0m

{ clusterSize: 4 }
[33m### ADDING 172.31.5.17:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.17:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2666350 keys | 4096 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1473129 keys | 4096 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 653241 keys | 4096 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 4096 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.17:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.17:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2298342 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1034667 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 431600 keys | 3276 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1028111 keys | 3280 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 5 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 5 nodes. Total weight = 5.00



[34m******* resize , 5 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 6 *******[0m

{ clusterSize: 5 }
[33m### ADDING 172.31.5.50:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.50:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 2298342 keys | 3276 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 1034667 keys | 3276 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 431600 keys | 3276 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 1028111 keys | 3280 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 534668 keys | 3276 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.50:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.50:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1881563 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 641071 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1732422 keys | 2734 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 715265 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 6 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 6 nodes. Total weight = 6.00



[34m******* resize , 6 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 7 *******[0m

{ clusterSize: 6 }
[33m### ADDING 172.31.5.251:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.251:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1881563 keys | 2730 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 641071 keys | 2730 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2730 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1732422 keys | 2734 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 715265 keys | 2730 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 357067 keys | 2730 slots | 0 slaves.
[OK] 5327388 keys in 7 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.251:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.251:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1629652 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 372923 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1348472 keys | 2344 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1419576 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 556765 keys | 2340 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5327388 keys in 7 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 7 nodes. Total weight = 7.00



[34m******* resize , 7 completed ******* [0m 

------------------------------------------------------------------

[34m******* resize , 8 *******[0m

{ clusterSize: 7 }
[33m### ADDING 172.31.5.69:6379 NODE TO CLUSTER ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster add-node 172.31.5.69:6379 172.31.5.107:6379 | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1629652 keys | 2340 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 372923 keys | 2340 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2340 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1348472 keys | 2344 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1419576 keys | 2340 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 556765 keys | 2340 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 0 keys | 0 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2340 slots | 0 slaves.
[OK] 5327388 keys in 8 masters.
325.16 keys per slot on average.
 
total slots: 16384
node added successfully
waiting... 2 1 


waiting... 10 9 8 7 6 5 4 3 2 1 


[33m### REBALANCING CLUSTER ON 172.31.5.69:6379 ###
[0m
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
> redis-cli --cluster rebalance 172.31.5.69:6379 --cluster-use-empty-masters | grep -i Rebalancing
> redis-cli --cluster check 172.31.5.107:6379 | grep keys | awk '{ gsub(/[[0-9;]*m/, ""); print }'
assertion success.
postcheck: 
 [33m### CHECK NODE 172.31.5.107:6379 ###
[0m172.31.5.107:6379 (c5743b69...) -> 1517836 keys | 2048 slots | 0 slaves.
172.31.5.143:6379 (d509fa17...) -> 230908 keys | 2048 slots | 0 slaves.
172.31.5.4:6379 (58f8a9e3...) -> 0 keys | 2048 slots | 0 slaves.
172.31.5.251:6379 (068fb74f...) -> 1077820 keys | 2048 slots | 0 slaves.
172.31.5.50:6379 (e5a4e8ac...) -> 1382860 keys | 2048 slots | 0 slaves.
172.31.5.17:6379 (4dbdb61a...) -> 432329 keys | 2048 slots | 0 slaves.
172.31.5.69:6379 (9141b753...) -> 685635 keys | 2048 slots | 0 slaves.
172.31.5.169:6379 (bc2140ab...) -> 0 keys | 2048 slots | 0 slaves.
[OK] 5327388 keys in 8 masters.
325.16 keys per slot on average.
 
total slots: 16384
>>> Rebalancing across 8 nodes. Total weight = 8.00



[34m******* resize , 8 completed ******* [0m 

Time Taken: 18767.855 seconds...

---DONE---
